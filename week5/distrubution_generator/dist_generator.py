import math

import numpy as np
import matplotlib.pyplot as plt

class Model:
    def __init__(self, p1, p2, p3, p4):
        self.p1 = p1
        self.p2 = p2
        self.p3 = p3
        self.p4 = p4

    def model_at(self, x):
        scale = x/14
        a1 = self.p1 * math.pow(1-scale, self.p2)
        a2 = self.p3 + (self.p4 * math.log(scale))
        a3 = math.pow(scale, a2)
        
        return a1*a3

bins = [0.20300000000000001, 0.216, 0.22900000000000001, 0.24299999999999999, 0.25700000000000001, 0.27200000000000002, 0.28699999999999998, 0.30299999999999999, 0.31900000000000001, 0.33500000000000002, 0.35199999999999998, 0.36899999999999999, 0.38700000000000001, 0.40500000000000003, 0.42399999999999999, 0.443, 0.46200000000000002, 0.48199999999999998, 0.502, 0.52300000000000002, 0.54400000000000004, 0.56599999999999995, 0.58799999999999997, 0.61099999999999999, 0.63400000000000001, 0.65700000000000003, 0.68100000000000005, 0.70499999999999996, 0.72999999999999998, 0.755, 0.78100000000000003, 0.80700000000000005, 0.83399999999999996, 0.86099999999999999, 0.88900000000000001, 0.91700000000000004, 0.94599999999999995, 0.97599999999999998, 1.006, 1.0369999999999999, 1.0680000000000001, 1.1000000000000001, 1.133, 1.1659999999999999, 1.2, 1.234, 1.2689999999999999, 1.3049999999999999, 1.341, 1.3779999999999999, 1.4159999999999999, 1.454, 1.4930000000000001, 1.5329999999999999, 1.573, 1.6140000000000001, 1.6559999999999999, 1.698, 1.7410000000000001, 1.7849999999999999, 1.8300000000000001, 1.875, 1.921, 1.968, 2.016, 2.0649999999999999, 2.1139999999999999, 2.1640000000000001, 2.2149999999999999, 2.2669999999999999, 2.3199999999999998, 2.3740000000000001, 2.4289999999999998, 2.4849999999999999, 2.5419999999999998, 2.6000000000000001, 2.6589999999999998, 2.7189999999999999, 2.7799999999999998, 2.8420000000000001, 2.9049999999999998, 2.9689999999999999, 3.0339999999999998, 3.1000000000000001, 3.1669999999999998, 3.2349999999999999, 3.3050000000000002, 3.3759999999999999, 3.448, 3.5209999999999999, 3.5960000000000001, 3.6720000000000002, 3.7490000000000001, 3.827, 3.907, 3.988, 4.0700000000000003, 4.1539999999999999, 4.2389999999999999, 4.3259999999999996, 4.4139999999999997, 4.5039999999999996, 4.5949999999999998, 4.6879999999999997, 4.782, 4.8780000000000001, 4.9749999999999996, 5.0739999999999998, 5.1749999999999998, 5.2770000000000001, 5.3810000000000002, 5.4870000000000001, 5.5949999999999998, 5.7050000000000001, 5.8170000000000002, 5.931, 6.0469999999999997, 6.165, 6.2850000000000001, 6.407, 6.5309999999999997, 6.6580000000000004, 6.7869999999999999, 6.9180000000000001, 7.0519999999999996, 7.1879999999999997, 7.3259999999999996, 7.4669999999999996, 7.6100000000000003, 7.7560000000000002, 7.9039999999999999, 8.0549999999999997, 8.2080000000000002, 8.3640000000000008, 8.5229999999999997, 8.6850000000000005, 8.8499999999999996, 9.0190000000000001, 9.1910000000000007, 9.3659999999999997, 9.5440000000000005, 9.7260000000000009, 9.9109999999999996, 10.1, 10.292, 10.488, 10.688000000000001, 10.891999999999999, 11.1, 11.311999999999999, 11.528, 11.747999999999999, 11.972, 12.199999999999999, 12.432, 12.669, 12.91]
bins = [b for b in bins if 1 <= b <= 10]
bin_widths = [(b-a) for b, a in zip(bins[1:], bins)]



x_range = np.arange(1, 10, 0.1)
model = Model(1.70475e1, 8.43990, -4.63149, -2.43023e-3)


def generate_numevents(x):
    mean = model.model_at(x)
    


fig, ax = plt.subplots(figsize=(5,4))


ax.loglog(x_range, [model.model_at(x) for x in x_range], color="black", label="Model")

ax.set_xlim(left=1, right=10)
ax.set_ylim(bottom=1, top=1e6)

ax.yaxis.grid(True)
ax.xaxis.grid(True, which="both")

#ax.bar(bins[:-1], [model.model_at(left) for left, width in zip(bins, bin_widths)],
#        width=bin_widths, log=False, color="None", edgecolor="black")

ax.scatter(bins[:-1], [model.model_at(left) for left, width in zip(bins, bin_widths)],
           color="red", marker="x", zorder=20, s=20, label="Generated")

ax.legend()

plt.show()
